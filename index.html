<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DocumentCloud Page Embed Test</title>
    <style>
    body {
      margin: 0;
      padding: 1em;
      font: 300 1em/1.6em 'Gotham', 'Proxima Nova', 'Avenir Next', Helvetica, Arial, sans-serif;
    }

    h1,
    h2 {
      font-weight: 300;
      line-height: 1.3em;
    }

    .main {
      margin: 0 auto;
      max-width: 960px;
    }

    header,
    section {
      margin-bottom: 3em;
    }

    .col {
      display: inline-block;
      vertical-align: top;
      line-height: 0;
    }
    .col * {
      line-height: 1.6em;
    }

    .col-of-3 {
      width: 31%;
      margin-right: 2%;
    }

    .col-3.col-of-3 {
      margin-right: 0;
    }

    .desc {
      font-style: italic;
      margin-top: -1em;
    }

    #live_options label {
      margin-left: 1em;
      text-transform: uppercase;
      font-size: 0.8em;
      font-weight: 500;
    }
    
    @media (max-width: 400px) {
      .hide-from-mobile {
        display: none;
      }

      .col-of-3 {
        display: block;
        width: auto;
      }
    }

    </style>
  </head>
  <body>
    <div class="main width-target">
      <header>
        <h1>DocumentCloud Page Embed Testbed</h1>
        <p>This page is flexible with a min-width of 320px and a max-width of 960px. The current width is <b class="width">…</b>. Bold pixel counts will update as the window is resized. Below 200px, we show a thumbnail and link. From 200-399px, we show a reduced interface. 400px and above gets the complete experience.</p>
        <p id="live_options">
          <b>Live options:</b>
          <label><input type="checkbox" class="option" id="option_page_navigator" data-option="pageNavigator" autocomplete="off"> Page navigator</label>
          <label><input type="checkbox" class="option" id="option_text_mode" data-option="text" autocomplete="off"> Text mode</label>
        </p>
      </header>

      <section class="row">
        <div class="col col-1 col-of-3 width-target">
          <h3>Unenhanced <span class="width">…</span></h3>
          <p class="desc">What readers see if loading fails or JavaScript is disabled.</p>

          <!--
            Start with embed_code.html, but then:
            - Remove `DC-embed` class
            - Remove `loader.js`
          -->
          <div data-version="1.0" style="font-size:10pt">
            <p><a class="DC-embed-resource" href="//www.documentcloud.org/documents/282753-lefler-thesis.html#document/p57" title="View page 57 of Lefler Thesis on DocumentCloud in new window or tab" target="_blank">Page 57 of Lefler Thesis</a></p>
            <img src="//assets.documentcloud.org/documents/282753/pages/lefler-thesis-p57-normal.gif" alt="Page 57 of Lefler Thesis" style="border:1px solid #ccc;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;max-width:700px;">
            <p>
              Contributed to DocumentCloud by Ted Han of DocumentCloud &bull;
              <a href="//assets.documentcloud.org/documents/282753/pages/lefler-thesis-p57.txt" title="View text of page 57 of Lefler Thesis in a new window or tab" target="_blank">View page as text</a>
            </p>
          </div>
        </div>
        <div class="col col-2 col-of-3 width-target">
          <h3>Enhanced <span class="width">…</span></h3>
          <p class="desc">What readers see once the embed is fully loaded.</p>

          <!-- Keep perfectly in sync with embed_code.html -->
          <div class="DC-embed" data-version="1.0" style="font-size:10pt">
            <p><a class="DC-embed-resource" href="//www.documentcloud.org/documents/282753-lefler-thesis.html#document/p57" title="View page 57 of Lefler Thesis on DocumentCloud in new window or tab" target="_blank">Page 57 of Lefler Thesis</a></p>
            <img src="//assets.documentcloud.org/documents/282753/pages/lefler-thesis-p57-normal.gif" alt="Page 57 of Lefler Thesis" style="border:1px solid #ccc;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;max-width:700px;">
            <p>
              Contributed to DocumentCloud by Ted Han of DocumentCloud &bull;
              <a href="//assets.documentcloud.org/documents/282753/pages/lefler-thesis-p57.txt" title="View text of page 57 of Lefler Thesis in a new window or tab" target="_blank">View page as text</a>
            </p>
          </div>
          <script src="dist/loader.js"></script>

        </div>
        <div class="col col-3 col-of-3 width-target">
          <h3>Legacy <span class="width">…</span></h3>
          <p class="desc">Old embed code format. Should look/act just like Enhanced.</p>

          <div id="direct_page_embed_1" class="DC-embed-enhanced" data-version="1.0" style="font-size:10pt"></div>
          <script src="dist/page_embed.js"></script>
          <script>
            DocumentCloud.embed.loadPage("//www.documentcloud.org/documents/282753-lefler-thesis.json", {
              page: 57,
              container: '#direct_page_embed_1'
            });
          </script>

        </div>
      </section>

      <section class="row hide-from-mobile">
        <div class="col width-target" style="width:50%;margin-right:2%;">
          <h3 class="width">…</h3>
          <div class="embed_via_ajax"></div>
        </div>
        <div class="col width-target" style="width:28%;margin-right:2%;">
          <h3 class="width">…</h3>
          <div class="embed_via_ajax"></div>
        </div>
        <div class="col width-target" style="width:15%;">
          <h3 class="width">…</h3>
          <div class="embed_via_ajax"></div>
        </div>
      </section>

      <!--[if gt IE 8]><!-->
      <section class="hide-from-mobile">
        <h2>Pixel-match Document Viewer, iframed</h2>
        <p>When the viewport is wide enough, this will display at 702px, which means the page image will be rendered at its native 700px width. Useful for doing pixel-level comparisons with the workspace and Document Viewer. <b>Live options at top of page won't affect this embed.</b></p>
        <div class="width-target" style="max-width:702px;margin:0 auto">
          <h3 class="width">…</h3>
          <div id="pym_page_embed_5"></div>
          <script src="dist/pym.js"></script>
          <script type="text/javascript">
            var pym_page_embed_5 = new pym.Parent('pym_page_embed_5', 'embed.html?slug=282753-lefler-thesis&page=57', {});
          </script>
        </div>
      </section>
      <!--<![endif]-->
    </div>

    <section class="width-target hide-from-mobile">
      <h2>Full width</h2>
      <h3 class="width">…</h3>
      <div class="embed_via_ajax"></div>
    </section>

    <script type="text/javascript">
      (function(){
        var $ = DocumentCloud.$;
        var _ = DocumentCloud._;

        // Cache width indicators and their parents so we don't have to do
        // expensive DOM lookups during `resize`;
        var $widths = $('.width');
        $widths.each(function(){
          $(this).data('target', $(this).closest('.width-target'));
        });
        var updateColWidths = function(){
          $widths.each(function(){
            $(this).text( $(this).data('target').css('width') );
          });
        };
        updateColWidths();
        $(window).on('resize', function() {
          updateColWidths();
        })

        // Live option changing
        $('.option').on('change', function(){
          var optionName = $(this).data('option');
          var optionVal  = $(this).prop('checked');
          _.each(DocumentCloud.embed.views.pages, function(containers, documentId) {
            _.each(containers, function(view, elementId) {
              if (view.openNote) {
                view.openNote.close();
              }
              view.options[optionName] = optionVal;
              view.$el.html(view.render());
            });
          });
        });

        // Ajax-inserted embed code test
        $.get('embed_code.html', function(data) {
          $('.embed_via_ajax').html(data);
        });

      })();
    </script>
  </body>
</html>

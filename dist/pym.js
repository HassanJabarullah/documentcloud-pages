(function(c){"function"===typeof define&&define.amd?define(c):"undefined"!==typeof module&&module.exports?module.exports=c():window.pym=c.call(this)})(function(){var c={},e=function(b){b=(new RegExp("[\\?&]"+b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)")).exec(location.search);return null===b?"":decodeURIComponent(b[1].replace(/\+/g," "))},f=function(b,c){return"*"===c.xdomain||b.origin.match(new RegExp(c.xdomain+"$"))?!0:void 0};c.Parent=function(b,c,d){this.id=b;this.url=c;this.el=document.getElementById(b);
this.iframe=null;this.settings={xdomain:"*"};this.messageRegex=new RegExp("^"+["pym",this.id,"(\\S+)","(.+)"].join("xPYMx")+"$");this.messageHandlers={};d=d||{};this._constructIframe=function(){var a=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var b="",c=this.url.indexOf("#");-1<c&&(b=this.url.substring(c,this.url.length),this.url=this.url.substring(0,c));0>this.url.indexOf("?")?this.url+="?":this.url+="&";this.iframe.src=this.url+"initialWidth="+a+"&childId="+this.id+
"&parentUrl="+encodeURIComponent(window.location.href)+b;this.iframe.setAttribute("width","100%");this.iframe.setAttribute("scrolling","no");this.iframe.setAttribute("marginheight","0");this.iframe.setAttribute("frameborder","0");this.el.appendChild(this.iframe);window.addEventListener("resize",this._onResize)};this._onResize=function(){this.sendWidth()}.bind(this);this._fire=function(a,b){if(a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,
b)};this.remove=function(){window.removeEventListener("message",this._processMessage);window.removeEventListener("resize",this._onResize);this.el.removeChild(this.iframe)};this._processMessage=function(a){if(f(a,this.settings)&&"string"===typeof a.data){a=a.data.match(this.messageRegex);if(!a||3!==a.length)return!1;this._fire(a[1],a[2])}}.bind(this);this._onHeightMessage=function(a){a=parseInt(a);this.iframe.setAttribute("height",a+"px")};this._onNavigateToMessage=function(a){document.location.href=
a};this.onMessage=function(a,b){a in this.messageHandlers||(this.messageHandlers[a]=[]);this.messageHandlers[a].push(b)};this.sendMessage=function(a,b){this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(["pym",this.id,a,b].join("xPYMx"),"*")};this.sendWidth=function(){this.sendMessage("width",this.el.offsetWidth.toString())};for(var a in d)this.settings[a]=d[a];this.onMessage("height",this._onHeightMessage);this.onMessage("navigateTo",this._onNavigateToMessage);window.addEventListener("message",
this._processMessage,!1);this._constructIframe();return this};c.Child=function(b){this.parentUrl=this.id=this.parentWidth=null;this.settings={renderCallback:null,xdomain:"*",polling:0};this.messageRegex=null;this.messageHandlers={};b=b||{};this.onMessage=function(a,b){a in this.messageHandlers||(this.messageHandlers[a]=[]);this.messageHandlers[a].push(b)};this._fire=function(a,b){if(a in this.messageHandlers)for(var c=0;c<this.messageHandlers[a].length;c++)this.messageHandlers[a][c].call(this,b)};
this._processMessage=function(a){f(a,this.settings)&&"string"===typeof a.data&&(a=a.data.match(this.messageRegex))&&3===a.length&&this._fire(a[1],a[2])}.bind(this);this._onWidthMessage=function(a){a=parseInt(a);a!==this.parentWidth&&(this.parentWidth=a,this.settings.renderCallback&&this.settings.renderCallback(a),this.sendHeight())};this.sendMessage=function(a,b){window.parent.postMessage(["pym",this.id,a,b].join("xPYMx"),"*")};this.sendHeight=function(){var a=document.getElementsByTagName("body")[0].offsetHeight.toString();
this.sendMessage("height",a)}.bind(this);this.scrollParentTo=function(a){this.sendMessage("navigateTo","#"+a)};this.navigateParentTo=function(a){this.sendMessage("navigateTo",a)};this.id=e("childId")||b.id;this.messageRegex=new RegExp("^pymxPYMx"+this.id+"xPYMx(\\S+)xPYMx(.+)$");var c=parseInt(e("initialWidth"));this.parentUrl=e("parentUrl");this.onMessage("width",this._onWidthMessage);for(var d in b)this.settings[d]=b[d];window.addEventListener("message",this._processMessage,!1);this.settings.renderCallback&&
this.settings.renderCallback(c);this.sendHeight();this.settings.polling&&window.setInterval(this.sendHeight,this.settings.polling);return this};(function(){for(var b=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),e=b.length,d=0;d<e;++d){var a=b[d];a.setAttribute("data-pym-auto-initialized","");""===a.id&&(a.id="pym-"+d);var f=a.getAttribute("data-pym-src"),g=a.getAttribute("data-pym-xdomain"),h={};g&&(h.xdomain=g);new c.Parent(a.id,f,h)}})();return c});
